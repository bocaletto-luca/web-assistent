<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title data-i18n="appTitle">Assistente Universale</title>
  <meta name="description" data-i18n="appDescription" content="Un assistente chat multilingua, moderno e responsive.">
  <style>
    /* Reset & Base */
    * { margin:0; padding:0; box-sizing:border-box; }
    html { font-family:sans-serif; font-size:16px; }
    body { display:flex; flex-direction:column; height:100vh; }

    /* Header */
    header { background:#0066cc; color:#fff; padding:.5rem 1rem; display:flex; align-items:center; justify-content:space-between; }
    .nav-brand { font-size:1.25rem; font-weight:600; }
    .controls { display:flex; gap:1rem; align-items:center; }
    select, button { font:inherit; padding:.25rem .5rem; }

    /* Main Chat */
    main { flex:1; display:flex; align-items:center; justify-content:center; background:#f5f5f5; padding:1rem; }
    .chat { background:#fff; width:100%; max-width:600px; height:80%; display:flex; flex-direction:column; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); overflow:hidden; }
    .messages { flex:1; padding:1rem; overflow-y:auto; }
    .message { margin-bottom:.75rem; max-width:70%; word-wrap:break-word; }
    .message.user { align-self:flex-end; background:#e0f0ff; color:#004a8f; border-radius:12px 12px 0 12px; padding:.5rem; }
    .message.bot  { align-self:flex-start; background:#f1f1f1; color:#333; border-radius:12px 12px 12px 0; padding:.5rem; }
    .chat-form { display:flex; border-top:1px solid #ddd; }
    .chat-form input { flex:1; border:none; padding:.75rem; font-size:1rem; }
    .chat-form button { background:#0066cc; color:#fff; border:none; padding:0 .75rem; cursor:pointer; }

    /* Footer */
    footer { text-align:center; padding:.5rem; font-size:.9rem; background:#eee; }
    
    /* Responsive */
    @media (max-width:480px) {
      header { flex-direction:column; align-items:flex-start; gap:.5rem; }
    }
  </style>
</head>
<body>
  <header>
    <div class="nav-brand" data-i18n="appTitle">Assistente Universale</div>
    <div class="controls">
      <label for="lang" data-i18n="selectLang">Lingua:</label>
      <select id="lang">
        <option value="it">Italiano</option>
        <option value="en">English</option>
        <option value="es">EspaÃ±ol</option>
        <option value="fr">FranÃ§ais</option>
        <option value="de">Deutsch</option>
        <option value="pt">PortuguÃªs</option>
        <option value="cn">ä¸­æ–‡</option>
        <option value="ja">æ—¥æœ¬èªž</option>
      </select>
      <button id="toggle-theme" aria-label="Toggle theme">ðŸŒ“</button>
    </div>
  </header>

  <main>
    <div class="chat">
      <div class="messages" id="messages" role="log" aria-live="polite"></div>
      <form class="chat-form" id="chatForm">
        <input type="text" id="userInput" data-i18n-placeholder="placeholder" placeholder="Scrivi un messaggioâ€¦" autocomplete="off" required>
        <button type="submit" id="sendBtn" data-i18n="sendButton">Invia</button>
      </form>
    </div>
  </main>

  <footer>
    <p data-i18n="footerText">Â© 2025 Tuo Nome. Tutti i diritti riservati.</p>
  </footer>

  <script>
    const uiKeys = [
      'appTitle','appDescription','selectLang','placeholder','sendButton','footerText','fallback'
    ];
    const supported = ['it','en','es','fr','de','pt','cn','ja'];
    let uiDict = {}, botDict = {};

    const elems = {};
    uiKeys.forEach(k => {
      elems[k] = document.querySelector(`[data-i18n="${k}"]`);
    });
    // placeholder elements
    const placeholderEl = document.querySelector('[data-i18n-placeholder]');

    const langSelect = document.getElementById('lang');
    const toggleTheme = document.getElementById('toggle-theme');
    const chatForm = document.getElementById('chatForm');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const messages = document.getElementById('messages');

    // Dark mode
    toggleTheme.addEventListener('click', () => {
      document.documentElement.dataset.theme = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
    });

    // Load both UI and bot phrases
    async function loadLanguage(lang) {
      if (!supported.includes(lang)) lang = 'it';
      langSelect.value = lang;
      localStorage.setItem('appLang', lang);

      // UI dictionary
      try {
        const uiRes = await fetch(`locales/${lang}.json`);
        uiDict = await uiRes.json();
        uiKeys.forEach(key => {
          if (key === 'placeholder') {
            userInput.placeholder = uiDict[key] || '';
          } else {
            const el = elems[key];
            if (el && uiDict[key]) el.innerText = uiDict[key];
          }
        });
        document.title = uiDict.appTitle || document.title;
        document.querySelector('meta[name="description"]').setAttribute('content', uiDict.appDescription||'');
      } catch (e) {
        console.error('UI load error', e);
      }

      // Bot phrases
      try {
        const botRes = await fetch(`phrases/${lang}.json`);
        botDict = await botRes.json();
      } catch (e) {
        console.error('Phrases load error', e);
        botDict = {};
      }

      // Clear chat on change
      messages.innerHTML = '';
    }

    // Chat logic
    function appendMessage(txt, who) {
      const m = document.createElement('div');
      m.className = `message ${who}`;
      m.textContent = txt;
      messages.appendChild(m);
      messages.scrollTop = messages.scrollHeight;
    }

    chatForm.addEventListener('submit', e => {
      e.preventDefault();
      const text = userInput.value.trim();
      if (!text) return;
      appendMessage(text, 'user');
      userInput.value = '';

      const key = text.toLowerCase();
      const reply = botDict[key]?.response || uiDict.fallback;
      setTimeout(() => appendMessage(reply, 'bot'), 300);
    });

    // Init
    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('appLang') || navigator.language.slice(0,2) || 'it';
      loadLanguage(saved);
    });
    langSelect.addEventListener('change', () => loadLanguage(langSelect.value));
  </script>
</body>
</html>
