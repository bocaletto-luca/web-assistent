<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin â€“ Assistente Universale</title>
  <meta name="description" content="Pannello di amministrazione per traduzioni e frasi del bot">
  <style>
    /* Reset & Base */
    * { margin:0; padding:0; box-sizing:border-box; }
    html { font-family:sans-serif; font-size:16px; }
    body { display:flex; flex-direction:column; min-height:100vh; }

    /* Header */
    header {
      background:#0066cc; color:#fff; padding:.75rem 1rem;
      display:flex; align-items:center; justify-content:space-between;
    }
    header h1 { font-size:1.25rem; }

    /* Layout */
    main { flex:1; display:flex; }
    .sidebar {
      width:240px; background:#f5f5f5; padding:1rem;
      border-right:1px solid #ddd;
    }
    .sidebar select { width:100%; padding:.5rem; margin-bottom:1rem; }
    .sidebar nav button {
      width:100%; padding:.5rem; margin-bottom:.5rem;
      border:none; background:#e0e0e0; cursor:pointer;
    }
    .sidebar nav button.active { background:#0066cc; color:#fff; }

    .editor {
      flex:1; padding:1rem; overflow-y:auto;
    }
    .editor h2 { margin-bottom:.5rem; font-size:1.1rem; }
    form { display:grid; grid-gap:.75rem; margin-bottom:1rem; }

    form .field {
      display:flex; flex-direction:column;
    }
    form .field label { margin-bottom:.25rem; font-weight:500; }
    form .field input,
    form .field textarea {
      padding:.5rem; border:1px solid #ccc; border-radius:4px;
      font-size:1rem;
    }
    textarea { resize:vertical; min-height:3rem; }

    .actions {
      display:flex; gap:1rem; flex-wrap:wrap;
    }
    .actions button {
      padding:.5rem 1rem; border:none; background:#0066cc;
      color:#fff; cursor:pointer; border-radius:4px;
    }

    /* Hidden view */
    .hidden { display:none; }

    /* Footer */
    footer {
      text-align:center; padding:.5rem; font-size:.85rem;
      background:#eee;
    }

    /* Dark mode */
    :root[data-theme="dark"] {
      --bg: #222; --fg: #ddd; --bg-alt: #333; --border: #444;
    }
    :root[data-theme="dark"] body { background:var(--bg); color:var(--fg); }
    :root[data-theme="dark"] .sidebar { background:var(--bg-alt); }
    :root[data-theme="dark"] .sidebar nav button { background:var(--border); }
    :root[data-theme="dark"] .sidebar nav button.active { background:#0055aa; }
    :root[data-theme="dark"] .editor { background:var(--bg); }
    :root[data-theme="dark"] form .field input,
    :root[data-theme="dark"] form .field textarea {
      background:var(--bg-alt); color:var(--fg); border:1px solid var(--border);
    }
    :root[data-theme="dark"] header { background:#0055aa; }
    :root[data-theme="dark"] .actions button { background:#0055aa; }
  </style>
</head>
<body data-theme="light">
  <header>
    <h1>Admin â€“ Assistente Universale</h1>
    <button id="toggle-theme" aria-label="Cambia tema">ðŸŒ“</button>
  </header>

  <main>
    <aside class="sidebar">
      <label for="langSelect">Seleziona lingua</label>
      <select id="langSelect">
        <option value="it">Italiano</option>
        <option value="en">English</option>
        <option value="es">EspaÃ±ol</option>
        <option value="fr">FranÃ§ais</option>
        <option value="de">Deutsch</option>
        <option value="pt">PortuguÃªs</option>
        <option value="cn">ä¸­æ–‡</option>
        <option value="ja">æ—¥æœ¬èªž</option>
      </select>
      <nav>
        <button data-view="ui" class="active">Testi UI</button>
        <button data-view="phrases">Frasi Bot</button>
      </nav>
    </aside>

    <section class="editor">
      <!-- UI Texts Editor -->
      <div id="view-ui">
        <h2>Modifica Testi UI</h2>
        <form id="uiForm"></form>
        <div class="actions">
          <button id="addUiKey">+ Nuova chiave UI</button>
          <button id="saveUi">ðŸ’¾ Salva UI</button>
        </div>
      </div>

      <!-- Bot Phrases Editor -->
      <div id="view-phrases" class="hidden">
        <h2>Modifica Frasi Bot</h2>
        <form id="phrasesForm"></form>
        <div class="actions">
          <button id="addPhraseKey">+ Nuova chiave Frase</button>
          <button id="savePhrases">ðŸ’¾ Salva Frasi</button>
        </div>
      </div>
    </section>
  </main>

  <footer>
    Â© 2025 Tuo Nome. Tutti i diritti riservati.
  </footer>

  <script>
    const supported = ['it','en','es','fr','de','pt','cn','ja'];
    let currentLang = 'it';
    let uiDict = {}, phraseDict = {};

    const langSelect      = document.getElementById('langSelect');
    const toggleTheme     = document.getElementById('toggle-theme');
    const navButtons      = document.querySelectorAll('.sidebar nav button');
    const viewUi          = document.getElementById('view-ui');
    const viewPhrases     = document.getElementById('view-phrases');
    const uiForm          = document.getElementById('uiForm');
    const phrasesForm     = document.getElementById('phrasesForm');
    const addUiKeyBtn     = document.getElementById('addUiKey');
    const saveUiBtn       = document.getElementById('saveUi');
    const addPhraseKeyBtn = document.getElementById('addPhraseKey');
    const savePhrasesBtn  = document.getElementById('savePhrases');

    // Tema chiaro/scuro
    toggleTheme.addEventListener('click', () => {
      const root = document.documentElement;
      root.dataset.theme = root.dataset.theme === 'dark' ? 'light' : 'dark';
    });

    // Cambia vista UI / Frasi
    navButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        navButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if (btn.dataset.view === 'ui') {
          viewUi.classList.remove('hidden');
          viewPhrases.classList.add('hidden');
        } else {
          viewUi.classList.add('hidden');
          viewPhrases.classList.remove('hidden');
        }
      });
    });

    // Carica dizionari JSON
    async function loadDictionaries(lang) {
      if (!supported.includes(lang)) lang = 'it';
      currentLang = lang;
      langSelect.value = lang;
      uiForm.innerHTML = '';
      phrasesForm.innerHTML = '';

      try {
        uiDict = await fetch(`locales/${lang}.json`).then(r => r.json());
      } catch {
        uiDict = {};
      }
      try {
        phraseDict = await fetch(`phrases/${lang}.json`).then(r => r.json());
      } catch {
        phraseDict = {};
      }

      buildForm(uiForm, uiDict, 'ui');
      buildForm(phrasesForm, phraseDict, 'phrases');
    }

    // Genera campi dinamici
    function buildForm(formEl, dict, type) {
      for (let key in dict) {
        const wrapper = document.createElement('div');
        wrapper.className = 'field';
        const label = document.createElement('label');
        label.textContent = key;
        const input = type === 'ui'
          ? document.createElement('input')
          : document.createElement('textarea');
        input.value = dict[key];
        input.dataset.key = key;
        wrapper.append(label, input);
        formEl.appendChild(wrapper);
      }
    }

    // Aggiungi nuovo campo
    function addField(type) {
      const formEl = type === 'ui' ? uiForm : phrasesForm;
      const key = prompt('Inserisci la nuova chiave:');
      if (!key) return;
      if (type==='ui') uiDict[key]='';
      else phraseDict[key]='';
      const wrapper = document.createElement('div');
      wrapper.className = 'field';
      const label = document.createElement('label');
      label.textContent = key;
      const input = type==='ui'
        ? document.createElement('input')
        : document.createElement('textarea');
      input.value = '';
      input.dataset.key = key;
      wrapper.append(label, input);
      formEl.appendChild(wrapper);
    }

    // Raccogli dati e salva
    async function saveDict(type) {
      const dict = {};
      const formEl = type==='ui' ? uiForm : phrasesForm;
      formEl.querySelectorAll('[data-key]').forEach(el => {
        dict[el.dataset.key] = el.value;
      });

      const url = `/api/save/${type}/${currentLang}`;
      try {
        // Tenta salvataggio via API
        await fetch(url, {
          method: 'PUT',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(dict)
        });
        alert('Salvataggio avvenuto con successo.');
      } catch {
        // Fallback: download JSON file
        const blob = new Blob(
          [JSON.stringify(dict,null,2)],
          {type:'application/json'}
        );
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${type}_${currentLang}.json`;
        a.click();
        alert('API non disponibile, scaricato JSON localmente.');
      }
    }

    // Eventi
    langSelect.addEventListener('change', () => loadDictionaries(langSelect.value));
    addUiKeyBtn.addEventListener('click', () => addField('ui'));
    addPhraseKeyBtn.addEventListener('click', () => addField('phrases'));
    saveUiBtn.addEventListener('click', () => saveDict('ui'));
    savePhrasesBtn.addEventListener('click', () => saveDict('phrases'));

    // Inizializzazione
    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('appLang') || navigator.language.slice(0,2) || 'it';
      loadDictionaries(saved);
    });
  </script>
</body>
</html>
